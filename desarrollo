# -- coding: utf-8 -- 
# se va a proceder a observar el cambio en el uso ocupado por vegetacion con diferentes sensosres (landsat 5 y landsat 8), asi como con diferentes indices (NDVI y GCI)
import os, sys

try:
    from osgeo import ogr, gdal
    from osgeo.gdalconst import *
    import numpy as np
  
except ImportError:
    import ogr, gdal
    from gdalconst import *
    import numpy as np

# this allows GDAL to throw Python Exceptions
gdal.UseExceptions()

#definimos el directorio
os.chdir(r'C:')

##################################################################################################################
#abrimos las bandas


VerdeLS8 = gdal.Open(r'LT05_L1TP_200034_19930719_20180217_01_T1_B3.tif')
RojoLS8 = gdal.Open(r'LT05_L1TP_200034_19930719_20180217_01_T1_B4.tif')
NIRLS8 = gdal.Open(r'LT05_L1TP_200034_19930719_20180217_01_T1_B5.tif')


VerdeLS5 = gdal.Open(r'LC08_L1TP_200034_20210716_20210721_01_T1_B2.tif')
RojoLS5 = gdal.Open(r'LC08_L1TP_200034_20210716_20210721_01_T1_B3.tif')
NIRLS5 = gdal.Open(r'LC08_L1TP_200034_20210716_20210721_01_T1_B4.tif')

#de momento no lo utilizamos
#Componemos una imagen multibanda uniendo todas las bandas
arcpy.CompositeBands_management("VerdeLS8";"RojoLS8";"NIRLS8", "Landsat8_mb.tif") as landsat8
              
arcpy.CompositeBands_management("VerdeLS5";"RojoLS5";"NIRLS5", "Landsat5_mb.tif") as landsat5


#reproyeccion
reprojected_raster = arcpy.ia.Reproject(input_raster, {"wkid" : 25830})


#recortar al area de interes

#Lo vamos a recortar con un recorte que esta en shp hay que pasarlo a tif y tulizarlo para recortar las capas
arcpy.Clip_management('C:/TP5/EJ4/Mosaico.tif','#','C:/TP5/EJ4/recortado.tif','C:/TP5/EJ4/corredor_henares.shp')   

#conocer la informacion de la imagen
# lo separamos por bandas por si hubiera algun error en alguna de ellas
#dar a elegir con que satelite trabajaremos primero
inpunt ('Satelite con el que quiere trabajar primero (Landsat 5 o Landsat 8):  ')


#obtengo la informacion de la zona recortada
#la info de las bandas
#Ruta actual
#el directorio es el establecido en C, que se encuentra definido al inicio del script, asi como las bandas utilizadas de los dos sensores, que ya estan listas para su lectura
#el índice de banda comienza en 1 en lugar de 0.
in_ds = gdal.Open(band1_fn)
in_band = in_ds.GetRasterBand(1)
 
#definimos los parametros que queremos conocer
gtiff_driver = gdal.GetDriverByName('GTiff')
out_ds = gtiff_driver.Create('color.tif',
         in_band.XSize, in_band.YSize, 3, in_band.DataType)
out_ds.SetProjection(in_ds.GetProjection())
out_ds.SetGeoTransform(in_ds.GetGeoTransform())
 
 # Leer los datos de la primera banda
in_data = in_band.ReadAsArray()
out_band = out_ds.GetRasterBand(3)
out_band.WriteArray(in_data)
 
 # Leer los datos de la segunda banda
in_ds = gdal.Open(band2_fn)
out_band = out_ds.GetRasterBand(2)
out_band.WriteArray(in_ds.ReadAsArray())
 
 # Leer los datos de la tercera banda
out_ds.GetRasterBand(1).WriteArray(
    gdal.Open(band3_fn).ReadAsArray())
 
out_ds.FlushCache()
for i in range(1, 4):
    out_ds.GetRasterBand(i).ComputeStatistics(False)
 
out_ds.BuildOverviews('average', [2, 4, 8, 16, 32])
del out_ds




#definir funcion para calcular indices NDVI y GCI
# obtener bandas y tamaños de bloques

